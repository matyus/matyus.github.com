<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Matyus - Raspberry Pi Public Web Server</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
    <link href="/stylesheets/normalize.css" rel="stylesheet" />
    <link href="/stylesheets/base.css" rel="stylesheet" />
  </head>
  <body>
    <h1 id="logotype"><a href="/" title="Home">Matyus</a></h1>

    <div id="main" class="main" role="main">
      <h1 id="raspberry-pi-public-web-server">Raspberry Pi Public Web Server</h1>

<p>What does it take to get Raspberry Pi running as a public web server? This article will outline the basics of getting a Rails app started on a Raspberry Pi.</p>

<h2 id="installing-rvm">Installing RVM</h2>

<p>The Ruby Version Manager is worthwhile for two reasons: you have an easy way to maintain your version of Ruby, and secondly, you'll need the <code>rvmsudo</code> command to run your rails server publicly (more on that later).</p>

<p>Install <code>rvm</code> in Single-User Mode because then you won't have to worry about prefixing <code>sudo</code> every time you <code>gem install &lt;some-gem&gt;</code>. The <a href="https://rvm.io/rvm/install">RVM Install</a> suggests installing it, and then adding the execution path to your <code>.bash_profile</code>, if you're using something like ZSH, then you're probably savvy enough to know that you're going to have to change <code>.bash_profile</code> to <code>.profile</code> or even <code>.zshrc</code> in the example:</p>

<pre><code>\curl -sSL https://get.rvm.io | bash -s -- --ignore-dotfiles
echo "source $HOME/.rvm/scripts/rvm" &gt;&gt; ~/.bash_profile
</code></pre>

<p>The run the <code>rvm</code> command in your terminal to make sure it's working. The next thing I do is install the latest stable version of ruby (at the time of writing, it is <code>v2.3.0</code>).</p>

<pre><code>rvm install 2.3.0 --default
</code></pre>

<p>You'll notice that installing and compiling Ruby like this takes forever on a Raspberry Pi…</p>

<h2 id="installing-rails">Installing Rails</h2>

<p>When I ran <code>gem install rails</code> it took forever, and then got hung up at the end when it was building the docs for the rails gem. So, if you don't want to risk that happening, build it without the docs:</p>

<pre><code>gem install rails --no-ri --no-rdoc
</code></pre>

<p>Once that's done, you're ready to create a new rails app.</p>

<h2 id="running-a-rails-server-publicly">Running a Rails Server Publicly</h2>

<p>Normally, to run a server in development, it's perfectly acceptable to run <code>bundle exec rails server</code>, but the default port <code>3000</code> isn't useful unless you're on localhost. Port <code>80</code> is where public servers run, and as a safety precaution, running <code>bundle exec rails server -p 80</code> will get an error that contains this information:</p>

<pre><code>/home/pi/.rvm/rubies/ruby-2.3.0/lib/ruby/2.3.0/socket.rb:205:in `bind': Permission denied - bind(2) for 127.0.0.1:80 (Errno::EACCES)
</code></pre>

<p>So that's where <code>rvmsudo</code> comes into play:</p>

<pre><code>rvmsudo bundle exec rails s -b 0.0.0.0 -p 80
</code></pre>

<p><code>rvmsudo</code> is better than <code>sudo</code> because it carries all the ruby environment variables along with it. <code>-b</code> binds to any IP, and <code>-p</code> opens port 80. <a href="http://ruby.about.com/od/rubyversionmanager/qt/Rvm-And-Sudo.htm">More info</a></p>

<h2 id="were-almost-there">We're almost there</h2>

<p>So now, your server is pseudo-public, meaning that anyone connected to your WIFI network can freely access your rails server, most likely by visiting <code>http://raspberrypi.local/</code>. There's some port-forwarding magic that needs to happen if you're going to let the whole world visit your site.</p>

<p>We now have to enter the wonderful world of Optimum Online. If you're like me and recently signed up for internet access with Optimum, you'll notice that they included a Wifi router with the Modem installation. At first I thought this was weird, and silly, but now I'm realizing just how amazing it is…</p>

<h2 id="optimum-wifi-config">Optimum Wifi Config</h2>

<p>Optimum, for some strange reason, went through all the trouble of providing a complete web interface for your router. What happens is when you visit <code>http://192.168.1.1</code> to access your Wifi config, it redirects you to an Optimum.net login screen where you can adjust the settings from.</p>

<p>What you need to do when you get to this landing page is navigate to <code>Router Settings &gt; Advanced Settings &gt; Advanced Settings &gt; Port Manangement</code>. We're going to setup is <strong>Portforwarding</strong> so that you can tell your Modem that all Web requests go to the same place (the Rails server on the Pi).</p>

<p>Click "Add Port Forwarding Rule" to set it up so that the "Service" changes from "User-Defined Service" to "HTTP Web Access", this setting will bake in forwarding for ports 80, 8000, 8080, 8888, and 3127. Then change "Select a Host" to "<code>raspberrypi | MAC ADDRESS | IP ADDRESS</code>". Also update "Locate Device By" to "Host Name" radio button. Then save your changes.</p>

<p>Depending on your service plan, you may have to upgrade your access to actually gain control of ports 25 and 80. I found this out the hard way when I wandered onto a product page for <a href="https://www.optimum.net/internet/boost/">Port Configuration/Dynamic DNS service</a>:</p>

<blockquote>
  <p>You do not currently have access to these features.</p>

  <p>In order to manage Port 25, Port 80 or Dynamic DNS, you must subscribe to Optimum Online Ultra 50, Optimum Online Ultra 75 or Optimum Online Ultra 101. Please visit optimum.com for more information or to upgrade your service.</p>
</blockquote>

<p>Unfortunately I'm the cheapskate who needs to upgrade to <em>Optimum Online Ultra 50</em>.
is is an example article. You probably want to delete it and write your own articles!</p>


    </div>


    <aside hidden>
      <h2>Recent Articles</h2>
      <ol>
          <li><a href="/2016/01/06/raspberry-pi-public-webserver/">Raspberry Pi Public Web Server</a> <span>Jan  6</span></li>
          <li><a href="/2016/01/01/hello-world/">Hello World!</a> <span>Jan  1</span></li>
      </ol>

      <h2>Tags</h2>
      <ol>
          <li><a href="/tags/hello-world/">hello world (1)</a></li>
          <li><a href="/tags/raspberry-pi/">raspberry pi (1)</a></li>
          <li><a href="/tags/raspbian/">raspbian (1)</a></li>
          <li><a href="/tags/ruby-on-rails/">ruby on rails (1)</a></li>
      </ol>

      <h2>By Year</h2>
      <ol>
          <li><a href="/2016/">2016 (2)</a></li>
      </ol>
    </aside>

    <footer role="contentinfo">
      <p><a href="mailto:michael@maty.us">Contact me</a> with any questions or comments.</p>
    </footer>
  </body>
</html>
